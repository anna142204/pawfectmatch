openapi: 3.1.0
info:
  title: PawfectMatch API
  description: >
    API for PawfectMatch, a platform that connects animal adopters with pets available for adoption.
    Users can register as adopters or owners, browse available animals, match with animals if the owner agrees,
    and communicate through a discussion system.
  version: 1.0.0

servers:
  - url: http://localhost:8989
    description: Development server

paths:
  # Authentication Endpoints
  /api/auth/register/adopter:
    post:
      summary: Register a new adopter
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - firstName
                - lastName
                - email
                - password
                - age
                - address
              properties:
                firstName:
                  type: string
                  maxLength: 100
                  examples:
                    - Marie
                lastName:
                  type: string
                  maxLength: 100
                  examples:
                    - Martin
                email:
                  type: string
                  format: email
                  maxLength: 254
                  examples:
                    - marie.martin@example.com
                password:
                  type: string
                  minLength: 6
                  maxLength: 128
                  examples:
                    - securePassword123
                age:
                  type: integer
                  minimum: 18
                  examples:
                    - 28
                address:
                  type: object
                  required:
                    - zip
                    - city
                  properties:
                    zip:
                      type: string
                      maxLength: 12
                      examples:
                        - "1000"
                    city:
                      type: string
                      maxLength: 100
                      examples:
                        - "Lausanne"
                about:
                  type: string
                  maxLength: 150
                  examples:
                    - Passionné par les animaux
                preferences:
                  type: object
                  properties:
                    environment:
                      type: array
                      items:
                        type: string
                        enum: [appartement, voiture, enfant, chien, chat, autre animaux]
                        maxLength: 30
                      examples:
                        - [appartement, enfant]
                    species:
                      type: array
                      items:
                        type: string
                        maxLength: 50
                      examples:
                        - [chat, chien]
                    sizePreference:
                      type: array
                      items:
                        type: string
                        enum: [petit, moyen, grand]
                        maxLength: 10
                      examples:
                        - [petit, moyen]
      responses:
        "201":
          description: Adopter registered successfully
          headers:
            Set-Cookie:
              description: httpOnly JWT cookie
              schema:
                type: string
              examples:
                - auth_token=jwt.token.value; HttpOnly; Path=/; SameSite=Strict
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - Inscription réussie
                  user:
                    $ref: "#/components/schemas/Adopter"
                  type:
                    type: string
                    enum: [adopter]
                    examples:
                      - adopter
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Tous les champs requis doivent être remplis
        "409":
          description: Email already registered
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Cet email est déjà enregistré
        "500":
          description: Registration error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Échec de l'inscription

  /api/auth/register/owner:
    post:
      summary: Register a new owner
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - firstName
                - lastName
                - email
                - password
                - address
              properties:
                firstName:
                  type: string
                  maxLength: 100
                  examples:
                    - John
                lastName:
                  type: string
                  maxLength: 100
                  examples:
                    - Doe
                email:
                  type: string
                  format: email
                  maxLength: 254
                  examples:
                    - john.doe@example.com
                password:
                  type: string
                  minLength: 6
                  maxLength: 128
                  examples:
                    - securePassword123
                phoneNumber:
                  type: string
                  maxLength: 30
                  examples:
                    - "+41 79 123 45 67"
                societyName:
                  type: string
                  maxLength: 150
                address:
                  type: object
                  required:
                    - zip
                    - city
                  properties:
                    zip:
                      type: string
                      maxLength: 12
                    city:
                      type: string
                      maxLength: 100
                about:
                  type: string
                  maxLength: 150
      responses:
        "201":
          description: Owner registered successfully
          headers:
            Set-Cookie:
              description: httpOnly JWT cookie
              schema:
                type: string
              examples:
                - auth_token=jwt.token.value; HttpOnly; Path=/; SameSite=Strict
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - Inscription réussie
                  user:
                    $ref: "#/components/schemas/Owner"
                  type:
                    type: string
                    enum: [owner]
                    examples:
                      - owner
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Tous les champs requis doivent être remplis
        "409":
          description: Email already registered
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Cet email est déjà enregistré
        "500":
          description: Registration error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Échec de l'inscription

  /api/auth/login:
    post:
      summary: Login user (adopter or owner)
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - type
              properties:
                email:
                  type: string
                  format: email
                  maxLength: 254
                  examples:
                    - marie.martin@example.com
                password:
                  type: string
                  minLength: 6
                  maxLength: 128
                  examples:
                    - securePassword123
                type:
                  type: string
                  enum: [adopter, owner]
                  description: User type initiating the login
                  examples:
                    - adopter
      responses:
        "200":
          description: Login successful
          headers:
            Set-Cookie:
              description: httpOnly JWT cookie
              schema:
                type: string
              examples:
                - auth_token=jwt.token.value; HttpOnly; Path=/; SameSite=Strict
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    description: User object (Adopter, Owner, or Admin)
                  type:
                    type: string
                    enum: [adopter, owner, admin]
                    examples:
                      - adopter
        "400":
          description: Missing required fields
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Email et mot de passe requis
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Email ou mot de passe invalide
        "500":
          description: Login error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Échec de la connexion

  /api/auth/logout:
    post:
      summary: Logout user
      tags:
        - Authentication
      security:
        - CookieAuth: []
        - BearerAuth: []
      responses:
        "200":
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        "500":
          description: Logout error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string

  /api/auth/me:
    get:
      summary: Get current authenticated user
      tags:
        - Authentication
      security:
        - CookieAuth: []
        - BearerAuth: []
      responses:
        "200":
          description: Current user information
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    description: User object (Adopter, Owner, or Admin)
                  type:
                    type: string
                    enum: [adopter, owner, admin]
                    examples:
                      - adopter
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Authentification requise
        "500":
          description: Error fetching user
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Erreur lors de la récupération de l'utilisateur

  # Image Upload Routes
  /api/images/{type}:
    post:
      summary: Upload images (for owner, adopter, or animal)
      tags:
        - Images
      security:
        - CookieAuth: []
        - BearerAuth: []
      parameters:
        - name: type
          in: path
          required: true
          schema:
            type: string
            enum: [owner, adopter, animal]
          description: Type of entity uploading images
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - image
              properties:
                image:
                  type: array
                  items:
                    type: string
                    format: binary
                  maxItems: 10
                  description: Image files to upload (single or multiple, max 10)
      responses:
        "200":
          description: Images uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    oneOf:
                      - type: object
                        description: Single image response
                        properties:
                          url:
                            type: string
                            format: url
                          publicId:
                            type: string
                      - type: object
                        description: Multiple images response
                        properties:
                          images:
                            type: array
                            items:
                              type: object
                              properties:
                                url:
                                  type: string
                                  format: url
                                publicId:
                                  type: string
                  message:
                    type: string
                    examples:
                      - Upload réussi
        "400":
          description: Invalid image or type
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Aucun fichier fourni"
        "500":
          description: Upload error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string

  /api/images:
    delete:
      summary: Delete an image
      tags:
        - Images
      security:
        - CookieAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - publicId
              properties:
                publicId:
                  type: string
                  description: Cloudinary public ID of the image to delete
      responses:
        "200":
          description: Image deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - Image supprimée avec succès
        "400":
          description: Missing publicId or deletion failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - publicId est requis
        "500":
          description: Delete error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Erreur lors de la suppression de l'image

  # Animal Endpoints
  /api/animals:
    post:
      summary: Create a new animal
      tags:
        - Animals
      security:
        - CookieAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - species
                - name
                - age
                - sex
                - address
                - image
                - price
                - ownerId
                - description
                - characteristics
              properties:
                species:
                  type: string
                  maxLength: 50
                  enum: [chat, chien, lapin, oiseau, rongeur, autre]
                  examples:
                    - chien
                race:
                  type: string
                  maxLength: 80
                  examples:
                    - Labrador
                name:
                  type: string
                  maxLength: 80
                  examples:
                    - Buddy
                age:
                  type: string
                  enum: ['0-1', '1-3', '3-7', '7+']
                  examples:
                    - "3-7"
                sex:
                  type: string
                  maxLength: 10
                  enum: [male, female]
                size:
                  type: string
                  maxLength: 10
                  enum: [petit, moyen, grand]
                  examples:
                    - grand
                weight:
                  type: string
                  maxLength: 10
                  enum: ["0-5", "5-10", "10-20", "20-30", "30+"]
                  examples:
                    - "20-30"
                address:
                  type: object
                  required:
                    - city
                    - zip
                  properties:
                    city:
                      type: string
                      maxLength: 100
                    zip:
                      type: string
                      maxLength: 12
                images:
                  type: array
                  items:
                    type: string
                    format: url
                  minItems: 1
                  description: Array of image URLs (at least one required)
                price:
                  type: number
                  minimum: 0
                  examples:
                    - 150
                ownerId:
                  type: string
                  description: ID of the owner (references Owner model)
                availability:
                  type: boolean
                  default: true
                description:
                  type: string
                  maxLength: 300
                characteristics:
                  type: object
                  required:
                    - environment
                    - dressage
                    - personality
                  properties:
                    environment:
                      type: array
                      items:
                        type: string
                        maxLength: 30
                        enum: [appartement, voiture, enfant, chien, chat, "autre animaux"]
                      minItems: 1
                    dressage:
                      type: array
                      items:
                        type: string
                        maxLength: 30
                        enum: [éduqué, "facile à dresser", "habitué à la laisse", têtu]
                      minItems: 1
                    personality:
                      type: array
                      items:
                        type: string
                        maxLength: 30
                        enum: [calme, énergique, indépendant, affectueux, curieux, joueur, bavard, explorateur, câlin, protecteur, territorial, sociable, timide, peureux]
                      minItems: 1
      responses:
        "201":
          description: Animal created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - "Animal créé avec succès"
                  animal:
                    $ref: "#/components/schemas/Animal"
        "400":
          description: Validation error - required fields missing
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Tous les champs requis doivent être remplis"
        "500":
          description: Server error creating animal
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Échec de la création de l'animal"
                  details:
                    type: string

    get:
      summary: Get list of all animals with pagination and filtering
      tags:
        - Animals
      parameters:
        - name: species
          in: query
          schema:
            type: string
            enum: [chat, chien, lapin, oiseau, rongeur, autre]
        - name: race
          in: query
          schema:
            type: string
            maxLength: 80
        - name: name
          in: query
          schema:
            type: string
            maxLength: 80
        - name: age
          in: query
          schema:
            type: string
            enum: ['0-1', '1-3', '3-7', '7+']
        - name: sex
          in: query
          schema:
            type: string
            enum: [male, female]
        - name: city
          in: query
          schema:
            type: string
            maxLength: 100
        - name: zip
          in: query
          schema:
            type: string
            maxLength: 12
        - name: minPrice
          in: query
          schema:
            type: number
            minimum: 0
        - name: maxPrice
          in: query
          schema:
            type: number
            minimum: 0
        - name: ownerId
          in: query
          schema:
            type: string
        - name: availability
          in: query
          schema:
            type: boolean
        - name: environment
          in: query
          style: form
          explode: true
          schema:
            type: array
            items:
              type: string
              maxLength: 30
              enum: [appartement, voiture, enfant, chien, chat, "autre animaux"]
        - name: dressage
          in: query
          style: form
          explode: true
          schema:
            type: array
            items:
              type: string
              maxLength: 30
              enum: [éduqué, "facile à dresser", "habitué à la laisse", têtu]
        - name: personality
          in: query
          style: form
          explode: true
          schema:
            type: array
            items:
              type: string
              maxLength: 30
              enum: [calme, énergique, indépendant, affectueux, curieux, joueur, bavard, explorateur, câlin, protecteur, territorial, sociable, timide, peureux]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: List of animals
          content:
            application/json:
              schema:
                type: object
                properties:
                  animals:
                    type: array
                    items:
                      $ref: "#/components/schemas/Animal"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "500":
          description: Server error fetching animals
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Failed to fetch animals"

  /api/animals/{id}:
    get:
      summary: Get animal by ID
      tags:
        - Animals
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Animal found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Animal"
        "404":
          description: Animal not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Animal not found"
        "500":
          description: Server error fetching animal
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Failed to fetch animal"

    put:
      summary: Update an animal by ID
      tags:
        - Animals
      security:
        - CookieAuth: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                species:
                  type: string
                  maxLength: 50
                  enum: [chat, chien, lapin, oiseau, rongeur, autre]
                race:
                  type: string
                  maxLength: 80
                name:
                  type: string
                  maxLength: 80
                age:
                  type: string
                  enum: ['0-1', '1-3', '3-7', '7+']
                sex:
                  type: string
                  maxLength: 10
                  enum: [male, female]
                size:
                  type: string
                  maxLength: 10
                  enum: [petit, moyen, grand]
                weight:
                  type: string
                  maxLength: 10
                  enum: ["0-5", "5-10", "10-20", "20-30", "30+"]
                address:
                  type: object
                  properties:
                    city:
                      type: string
                      maxLength: 100
                    zip:
                      type: string
                      maxLength: 12
                images:
                  type: array
                  items:
                    type: string
                    format: url
                  description: Array of image URLs
                price:
                  type: number
                  minimum: 0
                availability:
                  type: boolean
                description:
                  type: string
                  maxLength: 300
                characteristics:
                  type: object
                  properties:
                    environment:
                      type: array
                      items:
                        type: string
                        maxLength: 30
                        enum: [appartement, voiture, enfant, chien, chat, "autre animaux"]
                      minItems: 1
                    dressage:
                      type: array
                      items:
                        type: string
                        maxLength: 30
                        enum: [éduqué, "facile à dresser", "habitué à la laisse", têtu]
                      minItems: 1
                    personality:
                      type: array
                      items:
                        type: string
                        maxLength: 30
                        enum: [calme, énergique, indépendant, affectueux, curieux, joueur, bavard, explorateur, câlin, protecteur, territorial, sociable, timide, peureux]
                      minItems: 1
      responses:
        "200":
          description: Animal updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - "Animal updated successfully"
                  animal:
                    $ref: "#/components/schemas/Animal"
        "400":
          description: Validation error in update request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        "404":
          description: Animal not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Animal not found"
        "500":
          description: Server error updating animal
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Failed to update animal"

    delete:
      summary: Delete an animal by ID
      tags:
        - Animals
      security:
        - CookieAuth: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Animal deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - "Animal deleted successfully"
        "404":
          description: Animal not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Animal not found"
        "500":
          description: Server error deleting animal
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Failed to delete animal"

  # Adopter Endpoints
  /api/adopters:
    get:
      summary: Get list of all adopters with pagination and filtering
      tags:
        - Adopters
      parameters:
        - name: firstName
          in: query
          schema:
            type: string
            maxLength: 100
          examples:
            - Alice
        - name: lastName
          in: query
          schema:
            type: string
            maxLength: 100
          examples:
            - Martin
        - name: email
          in: query
          schema:
            type: string
            format: email
            maxLength: 254
          examples:
            - alice@example.com
        - name: city
          in: query
          schema:
            type: string
            maxLength: 100
          examples:
            - Lausanne
        - name: zip
          in: query
          schema:
            type: string
            maxLength: 12
          examples:
            - "1000"
        - name: minAge
          in: query
          schema:
            type: integer
            minimum: 18
          examples:
            - 18
        - name: maxAge
          in: query
          schema:
            type: integer
            minimum: 18
          examples:
            - 65
        - name: environment
          in: query
          style: form
          explode: true
          schema:
            type: array
            items:
              type: string
              enum: [appartement, voiture, enfant, chien, chat, "autre animaux"]
              maxLength: 30
          examples:
            - [appartement, enfant]
        - name: species
          in: query
          style: form
          explode: true
          schema:
            type: array
            items:
              type: string
              maxLength: 50
          examples:
            - [chat, chien]
        - name: sizePreference
          in: query
          style: form
          explode: true
          schema:
            type: array
            items:
              type: string
              enum: [petit, moyen, grand]
              maxLength: 10
          examples:
            - [moyen, grand]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
      responses:
        "200":
          description: List of adopters
          content:
            application/json:
              schema:
                type: object
                properties:
                  adopters:
                    type: array
                    items:
                      $ref: "#/components/schemas/Adopter"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "500":
          description: Get adopters error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Failed to fetch adopters

  /api/adopters/{id}:
    get:
      summary: Get adopter by ID
      tags:
        - Adopters
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Adopter found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Adopter"
        "404":
          description: Adopter not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Adopter not found
        "500":
          description: Get adopter error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Failed to fetch adopter

    put:
      summary: Update an adopter by ID
      tags:
        - Adopters
      security:
        - CookieAuth: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                  maxLength: 100
                  examples:
                    - Alice
                lastName:
                  type: string
                  maxLength: 100
                  examples:
                    - Martin
                email:
                  type: string
                  format: email
                  maxLength: 254
                  examples:
                    - alice@example.com
                age:
                  type: integer
                  minimum: 18
                  examples:
                    - 28
                address:
                  type: object
                  properties:
                    zip:
                      type: string
                      maxLength: 12
                      examples:
                        - "1000"
                    city:
                      type: string
                      maxLength: 100
                      examples:
                        - Lausanne
                about:
                  type: string
                  maxLength: 150
                  examples:
                    - "Aime les animaux et vit en appartement"
                preferences:
                  type: object
                  properties:
                    environment:
                      type: array
                      items:
                        type: string
                        enum: [appartement, voiture, enfant, chien, chat, "autre animaux"]
                        maxLength: 30
                      examples:
                        - [appartement, enfant]
                    species:
                      type: array
                      items:
                        type: string
                        maxLength: 50
                      examples:
                        - [chat, chien]
                    sizePreference:
                      type: array
                      items:
                        type: string
                        enum: [petit, moyen, grand]
                        maxLength: 10
                      examples:
                        - [moyen]
      responses:
        "200":
          description: Adopter updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - Adopter updated successfully
                  adopter:
                    $ref: "#/components/schemas/Adopter"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        "404":
          description: Adopter not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Adopter not found
        "500":
          description: Update adopter error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Failed to update adopter

    delete:
      summary: Delete an adopter by ID
      tags:
        - Adopters
      security:
        - CookieAuth: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Adopter deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - Adopter deleted successfully
        "404":
          description: Adopter not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Adopter not found
        "500":
          description: Delete adopter error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Failed to delete adopter

  # Owner Endpoints
  /api/owners:
    get:
      summary: Get list of all owners with pagination and filtering
      tags:
        - Owners
      parameters:
        - name: firstName
          in: query
          schema:
            type: string
            maxLength: 100
        - name: lastName
          in: query
          schema:
            type: string
            maxLength: 100
        - name: email
          in: query
          schema:
            type: string
            format: email
            maxLength: 254
        - name: phoneNumber
          in: query
          schema:
            type: string
            maxLength: 30
        - name: city
          in: query
          schema:
            type: string
            maxLength: 100
        - name: zip
          in: query
          schema:
            type: string
            maxLength: 12
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: List of owners
          content:
            application/json:
              schema:
                type: object
                properties:
                  owners:
                    type: array
                    items:
                      $ref: "#/components/schemas/Owner"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "500":
          description: Server error fetching owners
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Failed to fetch owners"

  /api/owners/{id}:
    get:
      summary: Get owner by ID with associated animals
      tags:
        - Owners
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Owner found with associated animals
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Owner"
                  - type: object
                    properties:
                      animals:
                        type: array
                        items:
                          $ref: "#/components/schemas/Animal"
        "404":
          description: Owner not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Owner not found"
        "500":
          description: Server error fetching owner
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Failed to fetch owner"

    put:
      summary: Update an owner by ID
      tags:
        - Owners
      security:
        - CookieAuth: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        description: Password updates are not allowed on this route
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                  maxLength: 100
                lastName:
                  type: string
                  maxLength: 100
                email:
                  type: string
                  format: email
                  maxLength: 254
                phoneNumber:
                  type: string
                  maxLength: 30
                societyName:
                  type: string
                  maxLength: 150
                address:
                  type: object
                  properties:
                    zip:
                      type: string
                      maxLength: 12
                    city:
                      type: string
                      maxLength: 100
                about:
                  type: string
                  maxLength: 150
      responses:
        "200":
          description: Owner updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - "Owner updated successfully"
                  owner:
                    $ref: "#/components/schemas/Owner"
        "400":
          description: Validation error in update request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        "404":
          description: Owner not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Owner not found"
        "500":
          description: Server error updating owner
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Failed to update owner"

    delete:
      summary: Delete an owner by ID (only if no associated animals)
      tags:
        - Owners
      security:
        - CookieAuth: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Owner deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - "Owner deleted successfully"
        "400":
          description: Cannot delete owner with associated animals
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Cannot delete owner with associated animals"
                  animalsCount:
                    type: integer
        "404":
          description: Owner not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Owner not found"
        "500":
          description: Server error deleting owner
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Failed to delete owner"

  # Match Endpoints
  /api/matches:
    post:
      summary: Create a new match between adopter and animal
      tags:
        - Matches
      security:
        - CookieAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - animalId
              properties:
                animalId:
                  type: string
                  description: ID of the animal
      responses:
        "201":
          description: Match created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - "Match créé avec succès"
                  match:
                    $ref: "#/components/schemas/Match"
        "400":
          description: Invalid request or animal not available
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "L'identifiant de l'animal est requis"
        "404":
          description: Adopter or animal not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Adopteur introuvable"
        "409":
          description: Match already exists
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Ce match existe déjà"
        "500":
          description: Create match error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Échec de la création du match"

    get:
      summary: Get list of all matches with pagination
      tags:
        - Matches
      parameters:
        - name: adopterId
          in: query
          schema:
            type: string
        - name: animalId
          in: query
          schema:
            type: string
        - name: isActive
          in: query
          schema:
            type: boolean
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: List of matches
          content:
            application/json:
              schema:
                type: object
                properties:
                  matches:
                    type: array
                    items:
                      $ref: "#/components/schemas/Match"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "500":
          description: Get matches error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Échec de la récupération des matchs"

  /api/matches/pending-notifications:
    get:
      summary: Get pending match notifications for adopter
      tags:
        - Matches
      security:
        - CookieAuth: []
        - BearerAuth: []
      responses:
        "200":
          description: List of pending notifications
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    matchId:
                      type: string
                    animalId:
                      type: string
                    animalImage:
                      type: string
                    animalName:
                      type: string
                    animalSpecies:
                      type: string
                    animalRace:
                      type: string
                    adopterImage:
                      type: string
                    adopterName:
                      type: string
                    ownerName:
                      type: string
                    conversationLink:
                      type: string
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Non authentifié
        "403":
          description: Only adopters can retrieve pending notifications
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Seuls les adopteurs peuvent récupérer les notifications
        "500":
          description: Error fetching notifications
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Échec de la récupération des notifications en attente

  /api/matches/{id}:
    get:
      summary: Get match by ID
      tags:
        - Matches
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Match found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Match"
        "404":
          description: Match not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Match introuvable"
        "500":
          description: Get match error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Échec de la récupération du match"

    put:
      summary: Update a match by ID
      tags:
        - Matches
      security:
        - CookieAuth: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                isActive:
                  type: boolean
                status:
                  type: string
                  enum: [validé, refusé, adopté]
      responses:
        "200":
          description: Match updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - "Match mis à jour avec succès"
                  match:
                    $ref: "#/components/schemas/Match"
        "404":
          description: Match not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Match introuvable"
        "500":
          description: Update match error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Échec de la mise à jour du match"

    delete:
      summary: Delete a match by ID
      tags:
        - Matches
      security:
        - CookieAuth: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Match deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - "Match supprimé avec succès"
        "404":
          description: Match not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Match introuvable"
        "500":
          description: Delete match error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Échec de la suppression du match"

  /api/matches/{id}/messages:
    post:
      summary: Add a message to match discussion
      tags:
        - Matches
      security:
        - CookieAuth: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - sender
                - senderModel
                - message
              properties:
                sender:
                  type: string
                  description: ID of the sender (adopter or owner)
                senderModel:
                  type: string
                  enum: [Adopter, Owner]
                  maxLength: 20
                message:
                  type: string
                  maxLength: 1000
      responses:
        "200":
          description: Message added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - "Message ajouté avec succès"
                  match:
                    $ref: "#/components/schemas/Match"
        "400":
          description: Invalid message data or inactive match
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "L'expéditeur, le modèle d'expéditeur et le message sont requis"
        "404":
          description: Match not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Match introuvable"
        "500":
          description: Add message error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Échec de l'ajout du message"

  /api/matches/{id}/discussion:
    get:
      summary: Get match discussion messages
      tags:
        - Matches
      security:
        - CookieAuth: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Discussion messages
          content:
            application/json:
              schema:
                type: object
                properties:
                  matchId:
                    type: string
                  adopterId:
                    type: string
                  animalId:
                    type: string
                  isActive:
                    type: boolean
                  discussion:
                    type: array
                    items:
                      type: object
                      properties:
                        sender:
                          type: string
                        senderModel:
                          type: string
                          enum: [Adopter, Owner]
                        message:
                          type: string
                          maxLength: 1000
                        timestamp:
                          type: string
                          format: date-time
        "404":
          description: Match not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Match introuvable"
        "500":
          description: Get discussion error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - "Échec de la récupération de la discussion"

  /api/matches/{id}/adopt:
    patch:
      summary: Finalize adoption (mark match as adopted)
      tags:
        - Matches
      security:
        - CookieAuth: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Adoption finalized successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - Adoption finalisée avec succès
                  match:
                    $ref: "#/components/schemas/Match"
        "400":
          description: Match must be validated before adoption
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Le match doit être validé avant l'adoption
        "404":
          description: Match not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Match introuvable
        "500":
          description: Error finalizing adoption
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      - Échec de la finalisation de l'adoption

  # Admin Routes
  /api/admin/stats:
    get:
      summary: Get API statistics
      tags:
        - Admin
      responses:
        "200":
          description: API statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalAdopters:
                    type: number
                  totalOwners:
                    type: number
                  totalAnimals:
                    type: number
                  totalMatches:
                    type: number
        "500":
          description: Error retrieving statistics

components:
  schemas:
    Adopter:
      type: object
      properties:
        _id:
          type: string
          format: uuid
        firstName:
          type: string
          maxLength: 100
        lastName:
          type: string
          maxLength: 100
        email:
          type: string
          format: email
          maxLength: 254
        age:
          type: integer
          minimum: 18
        address:
          type: object
          properties:
            zip:
              type: string
              maxLength: 12
            city:
              type: string
              maxLength: 100
        location:
          type: object
          description: GeoJSON Point pour la localisation de l'adopteur
          properties:
            type:
              type: string
              enum: [Point]
            coordinates:
              type: array
              items:
                type: number
              description: "[longitude, latitude]"
              minItems: 2
              maxItems: 2
        about:
          type: string
          maxLength: 150
        preferences:
          type: object
          properties:
            environment:
              type: array
              items:
                type: string
                enum: [appartement, voiture, enfant, chien, chat, "autre animaux"]
                maxLength: 30
            species:
              type: array
              items:
                type: string
                maxLength: 50
            sizePreference:
              type: array
              items:
                type: string
                enum: [petit, moyen, grand]
                maxLength: 10
        image:
          type: string
          format: url
          maxLength: 500
          description: URL de l'image de profil de l'adopteur
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        __v:
          type: number

    Owner:
      type: object
      properties:
        _id:
          type: string
          format: uuid
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
          format: email
        phoneNumber:
          type: string
        address:
          type: object
          properties:
            zip:
              type: string
            city:
              type: string
        location:
          type: object
          description: GeoJSON Point pour la localisation du propriétaire
          properties:
            type:
              type: string
              enum: [Point]
            coordinates:
              type: array
              items:
                type: number
              description: "[longitude, latitude]"
              minItems: 2
              maxItems: 2
        societyName:
          type: string
          maxLength: 150
          description: Nom de la société (si propriétaire professionnel)
        about:
          type: string
        animalCount:
          type: number
          description: Nombre d'animaux associés à ce propriétaire (calculé par l'agrégation)
        image:
          type: string
          format: url
          maxLength: 500
          description: URL de l'image de profil du propriétaire
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        __v:
          type: number

    Animal:
      type: object
      properties:
        _id:
          type: string
          format: uuid
        species:
          type: string
        race:
          type: string
        name:
          type: string
        age:
          type: number
        sex:
          type: string
          enum: [male, female]
        size:
          type: string
          enum: [petit, moyen, grand]
        weight:
          type: string
        address:
          type: object
          properties:
            city:
              type: string
            zip:
              type: string
        location:
          type: object
          description: GeoJSON Point pour la localisation de l'animal
          properties:
            type:
              type: string
              enum: [Point]
            coordinates:
              type: array
              items:
                type: number
              description: "[longitude, latitude]"
              minItems: 2
              maxItems: 2
        distance:
          type: number
          description: Distance en km par rapport à l'utilisateur connecté (si géolocalisé)
          nullable: true
        images:
          type: array
          items:
            type: string
            format: url
          description: Array of image URLs
        price:
          type: number
        ownerId:
          type: string
        availability:
          type: boolean
        description:
          type: string
        characteristics:
          type: object
          properties:
            environment:
              type: array
              items:
                type: string
            dressage:
              type: array
              items:
                type: string
            personality:
              type: array
              items:
                type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        __v:
          type: number

    Match:
      type: object
      properties:
        _id:
          type: string
          format: uuid
        adopterId:
          oneOf:
            - type: string
            - $ref: "#/components/schemas/Adopter"
        animalId:
          oneOf:
            - type: string
            - $ref: "#/components/schemas/Animal"
        isActive:
          type: boolean
        discussion:
          type: array
          items:
            type: object
            properties:
              sender:
                type: string
              senderModel:
                type: string
                enum: [Adopter, Owner]
              message:
                type: string
              timestamp:
                type: string
                format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        __v:
          type: number

    Pagination:
      type: object
      properties:
        total:
          type: integer
        page:
          type: integer
        limit:
          type: integer
        pages:
          type: integer

    Admin:
      type: object
      properties:
        _id:
          type: string
          format: uuid
        email:
          type: string
          format: email
          maxLength: 254
        name:
          type: string
          maxLength: 100
        role:
          type: string
          maxLength: 20
          default: admin
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        __v:
          type: number

  securitySchemes:
    CookieAuth:
      type: apiKey
      in: cookie
      name: auth_token
      description: JWT authentication token delivered as httpOnly cookie
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token in Authorization header

tags:
  - name: Authentication
    description: User registration and login endpoints
  - name: Adopters
    description: Adopter management endpoints (GET, POST, PUT, DELETE)
  - name: Owners
    description: Owner management endpoints (GET, POST, PUT, DELETE)
  - name: Animals
    description: Animal listings and management (GET, POST, PUT, DELETE)
  - name: Matches
    description: Match creation and discussion management (GET, POST, PUT, DELETE, messages)
  - name: Images
    description: Image upload and deletion (POST, DELETE)
  - name: Admin
    description: Administrative endpoints for statistics